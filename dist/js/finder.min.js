!function(e){var t=Array.prototype;e.newPlugin=function(a,n,o,r){function s(t,o){this.opts=e.extend({},n,o),this.el=t,this._name=a,this._init()}s.prototype._init=e.noop,s.prototype[a]=function(e){if(!e)return this;try{return this[e].apply(this,t.slice.call(arguments,1))}catch(a){}},e.extend(s.prototype,o),r&&(e[a]=r),e.fn[a]=function(){var n,o=t.slice.call(arguments),r="string"==typeof o[0]&&o[0].split(":"),l="object"==typeof o[0]&&o[0],i=o.slice(1),d="get"==r[0];return this.each(function(){var t=e.data(this,a);return t?n=t[a].apply(t,[r[+d]].concat(i)):e.data(this,a,new s(this,l))}),d?n:this}}}(jQuery),window.DTFINDER=function(){return{lang:[],config:{data:{},classes:{},permissions:{}}}}(),DTFINDER.Locale={locale:null,localize:function(e){return"undefined"==typeof DTFINDER.lang[this.locale]?e:"undefined"==typeof DTFINDER.lang[this.locale][e]?("en"!==this.local&&console.warn("Missing translation: '"+e+"' for locale "+this.locale),e):DTFINDER.lang[this.locale][e]}},function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["file-item.html"]=function(){function e(e,t,a,n,o){var r=null,s=null,l="";try{var i=null;l+='<li class="dtf-file-item dtf-context-holder" data-context-target=\'#item-context-menu\' data-file-type="',l+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,a,"file"),"type"),e.opts.autoescape),l+='">\n    <a tabindex="-1" class="" href="',l+=n.suppressValue("#/"+n.memberLookup(n.contextOrFrameLookup(t,a,"file"),"path"),e.opts.autoescape),l+='">\n        <div class="dtf-file-img">\n            ',"image"==n.memberLookup(n.contextOrFrameLookup(t,a,"file"),"type")?(l+='\n                <img src="',l+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,a,"file"),"base64"),e.opts.autoescape),l+='" class="ui-li-thumb" data-path="',l+=n.suppressValue("#/"+n.memberLookup(n.contextOrFrameLookup(t,a,"file"),"path"),e.opts.autoescape),l+='">\n            '):l+="file"==n.memberLookup(n.contextOrFrameLookup(t,a,"file"),"type")?'\n                    <i class="fa fa-file-o"></i></div>\n            ':'\n                    <i class="fa fa-folder-o"></i></div>\n            ',l+='\n        </div>\n        <!-- @todo thumb -->\n        <!--<img src="" class="ui-li-thumb">-->\n        <div class="dtf-file-desc">',l+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,a,"file"),"label"),e.opts.autoescape),l+='</div>\n    </a>\n    <div class="dtf-item-context">\n        <a href="#" class="dtf-mobile-item-context"><i class="fa fa-angle-down"></i></a>\n    </div>\n</li>\n',i?i.rootRenderFunc(e,t,a,n,o):o(null,l)}catch(d){o(n.handleError(d,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["mobile-context-menu.html"]=function(){function e(e,t,a,n,o){var r=null,s=null,l="";try{var i=null;l+='<span class="mobile-context-menu dropdown pull-right"><a data-toggle="dropdown" href="#" style="font-size:1.4em"><i class="fa fa-angle-down"></i></a>\n    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">\n        <li><a data-path="',l+=n.suppressValue(n.contextOrFrameLookup(t,a,"path"),e.opts.autoescape),l+='" data-op="rename" class="dtf-mobile-context-action" href="#">',l+=n.suppressValue((r=2,s=96,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["Rename"])),e.opts.autoescape),l+='</a></li>\n        <li><a data-path="',l+=n.suppressValue(n.contextOrFrameLookup(t,a,"path"),e.opts.autoescape),l+='" data-op="move" class="dtf-mobile-context-action" href="#">',l+=n.suppressValue((r=3,s=94,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["Move"])),e.opts.autoescape),l+='</a></li>\n        <li><a data-path="',l+=n.suppressValue(n.contextOrFrameLookup(t,a,"path"),e.opts.autoescape),l+='" data-op="delete" class="dtf-mobile-context-action" href="#">',l+=n.suppressValue((r=4,s=96,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["Delete"])),e.opts.autoescape),l+='</a></li>\n        <li><a data-path="',l+=n.suppressValue(n.contextOrFrameLookup(t,a,"path"),e.opts.autoescape),l+='" data-op="properties" class="dtf-mobile-context-action" href="#">',l+=n.suppressValue((r=5,s=100,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["Properties"])),e.opts.autoescape),l+="</a></li>\n    </ul>\n</span>\n",i?i.rootRenderFunc(e,t,a,n,o):o(null,l)}catch(d){o(n.handleError(d,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["modal.html"]=function(){function e(e,t,a,n,o){var r=null,s=null,l="";try{var i=null;l+='<div id="',l+=n.suppressValue(n.contextOrFrameLookup(t,a,"id"),e.opts.autoescape),l+='" class="modal in">\n    <div class="modal-dialog ',l+=n.suppressValue(n.contextOrFrameLookup(t,a,"size"),e.opts.autoescape),l+='">\n        <div class="modal-content">\n            <div class="clearfix">\n                <button style="margin:5px 15px;" aria-label="Close" data-dismiss="modal" class="close" type="button"><span aria-hidden="true">Ã—</span></button>\n            </div>\n            <div class="modal-body">',l+=n.suppressValue(n.contextOrFrameLookup(t,a,"content"),e.opts.autoescape),l+=" </div>\n        </div>\n    </div>\n</div\n",i?i.rootRenderFunc(e,t,a,n,o):o(null,l)}catch(d){o(n.handleError(d,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["new-folder-form.html"]=function(){function e(e,t,a,n,o){var r=null,s=null,l="";try{var i=null;l+='<form method="GET" class="form clearfix" id="dtf-new-folder-form" action="',l+=n.suppressValue(n.contextOrFrameLookup(t,a,"createFolderUrl"),e.opts.autoescape),l+='">\n    <div class="form-group">\n        <label class="control-label">',l+=n.suppressValue((r=2,s=39,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["New Folder"])),e.opts.autoescape),l+='</label>\n        <input type="text" name="folder-name" value="New Folder" class="form-control new-folder-input"/>\n    </div>\n    <div class="form-group">\n        <input type="submit" class="btn btn-sm btn-primary pull-right" value="',l+=n.suppressValue((r=6,s=80,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["Submit"])),e.opts.autoescape),l+='"/>\n        <a href="javascript:;" class="btn btn-default btn-sm pull-right" data-dismiss="modal" style="margin-right:5px">',l+=n.suppressValue((r=7,s=121,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["Cancel"])),e.opts.autoescape),l+="</a>\n    </div>\n</form>\n",i?i.rootRenderFunc(e,t,a,n,o):o(null,l)}catch(d){o(n.handleError(d,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["properties.html"]=function(){function e(e,t,a,n,o){var r=null,s=null,l="";try{var i=null;l+='<table>\n    <tr><td class="property-label" valign="top" width="70px;">',l+=n.suppressValue((r=1,s=64,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["Name"])),e.opts.autoescape),l+="</td><td>",l+=n.suppressValue(n.contextOrFrameLookup(t,a,"Name"),e.opts.autoescape),l+='</td></tr>\n    <tr><td class="property-label" valign="top" width="70px;">',l+=n.suppressValue((r=2,s=64,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["Type"])),e.opts.autoescape),l+="</td><td>",l+=n.suppressValue(n.contextOrFrameLookup(t,a,"Type"),e.opts.autoescape),l+='</td></tr>\n    <tr><td class="property-label" valign="top" width="70px;">',l+=n.suppressValue((r=3,s=64,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["Size"])),e.opts.autoescape),l+="</td><td>",l+=n.suppressValue(n.contextOrFrameLookup(t,a,"Size"),e.opts.autoescape),l+='</td></tr>\n    <tr><td class="property-label" valign="top" width="70px;">',l+=n.suppressValue((r=4,s=64,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["Location"])),e.opts.autoescape),l+="</td><td>",l+=n.suppressValue(n.contextOrFrameLookup(t,a,"Location"),e.opts.autoescape),l+="</td></tr>\n</table>\n",i?i.rootRenderFunc(e,t,a,n,o):o(null,l)}catch(d){o(n.handleError(d,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["sub-browser.html"]=function(){function e(e,t,a,n,o){var r=null,s=null,l="";try{var i=null;l+='<div><button class="btn btn-xs pull-right btn-primary folder-selector">',l+=n.suppressValue((r=0,s=73,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["Select"])),e.opts.autoescape),l+="</button></div>\n",i?i.rootRenderFunc(e,t,a,n,o):o(null,l)}catch(d){o(n.handleError(d,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["template.html"]=function(){function e(e,t,a,n,o){var r=null,s=null,l="";try{var i=null;l+='<div id="dtf">\n    <div class="container">\n        <div class="row dtf-row">\n            <div class="dt-col col-md-6">\n                <a href="#" data-toggle="modal" data-target="#dtf-upload-dialog" class="btn btn-success">\n                    <i class="fa fa-upload" style=""></i> Upload\n                </a>\n\n                <a href="#" data-toggle="modal" data-target="#dtf-new-folder-dialog" class="btn btn-default">\n                    <i class="fa fa-folder-o"></i> New Folder\n                </a>\n            </div>\n            <div class="dt-col col-md-6">\n                <div class="row">\n                    <div class="col-md-5 col-md-offset-7">\n                        <input class="form-control dtf-search-input" placeholder="Search" type="search"/>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="row">\n            <div class="col-md-12">\n                <div id="dtf-breadcrumb-container">\n                    <a id="dtf-parent-folder" href="#">\n                        <i class="fa fa-reply"></i>\n                    </a>\n                    <span id="dtf-breadcrumb"> </span>\n                </div>\n            </div>\n        </div>\n        <div class="row">\n            <div class="col-md-12">\n                <div class="dtf-desktop-area">\n                    <div id="dtf-tree"></div>\n                    <div id="dtf-area" class="dtf-context-holder" data-context-target=\'#bro-context-menu\'></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n',i?i.rootRenderFunc(e,t,a,n,o):o(null,l)}catch(d){o(n.handleError(d,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["upload-form.html"]=function(){function e(e,t,a,n,o){var r=null,s=null,l="";try{var i=null;l+='<form method="POST" enctype="multipart/form-data" class="form clearfix" id="dtf-upload-form" action="',l+=n.suppressValue(n.contextOrFrameLookup(t,a,"uploadUrl"),e.opts.autoescape),l+='">\n    <input multiple type="file" name="files[]">\n    <div class="uploaded"></div>\n    <input type="submit" class="btn btn-primary btn-sm pull-right" value="',l+=n.suppressValue((r=3,s=76,n.callWrap(n.contextOrFrameLookup(t,a,"_"),"_",t,["Submit"])),e.opts.autoescape),l+='">\n</form>\n',i?i.rootRenderFunc(e,t,a,n,o):o(null,l)}catch(d){o(n.handleError(d,r,s))}}return{root:e}}()}(),DTFINDER.DOM={_render:function(e,t){var t=$.extend(t,{_:function(e){return DTFINDER.Locale.localize(e)}});return nunjucks.render(e,t)},create:function(e,t){var a=document.createElement(e);return"undefined"!=typeof t&&$.each(t,function(e,t){$(a).attr(e,t)}),$(a)},createBreadcrumb:function(){return this._render(DTFINDER.Template.breadcrumb())},createToolbar:function(){return this._render(DTFINDER.Template.toolbar())},createUploadDialog:function(e){var t=this._render("upload-form.html",{uploadUrl:e});return this.createModal("dtf-upload-dialog",t)},createNewFolderDialog:function(e){var t={createFolderUrl:e},a=this._render("new-folder-form.html",t);return this.createModal("dtf-new-folder-dialog",a,"modal-sm")},createSubBrowserDialog:function(){var e=this._render("sub-browser.html");return this.createModal("dtf-sub-browser-dialog",e,"modal-sm")},createPropertiesDialog:function(){return this.createModal("properties-dialog","","modal-sm")},createModal:function(e,t,a){var a=a||"";return this._render("modal.html",{id:e,content:t,size:a})},createBrowserContext:function(){var e={};return DTFINDER.config.permissions.create&&(e["new-folder"]=DTFINDER.Locale.localize("New Folder")+"â€¦"),e.properties=DTFINDER.Locale.localize("Properties"),this.createContextMenu("bro-context-menu",e)},createItemContext:function(){var e={};return DTFINDER.config.permissions.move&&(e.rename=DTFINDER.Locale.localize("Rename"),e.move=DTFINDER.Locale.localize("Move")+"â€¦"),DTFINDER.config.permissions["delete"]&&(e["delete"]=DTFINDER.Locale.localize("Delete")+"â€¦"),e.properties=DTFINDER.Locale.localize("Properties"),this.createContextMenu("item-context-menu",e)},createContextMenu:function(e,t){var a=this.create("UL",{role:"menu"}).addClass("dropdown-menu");$.each(t,$.proxy(function(e,t){var n=this.createContextAction(e,t);$(a).append(n)},this));var n=this.create("DIV",{id:e}).append(a);return n},createContextAction:function(e,t){var a=this.create("A",{href:"#"}).text(t),n=this.create("LI",{"data-action":e}).append(a);return n},createFileItem:function(e){return this._render("file-item.html",{file:e})}},function(e,t,a,n){var o,r,s,l,d="UL",c="LI",u="dttree-node-toggler";o="dttree",r={nodes:[],classes:{collapsedToggler:"fa fa-folder-o",expandedToggler:"fa fa-folder-open-o"}},s={_init:function(){this.$el=e(this.el);var t=this._renderNodes(this.opts.nodes);e(this.el).append(t),this._listen()},_listen:function(){var t=this;e(this.el).on("click","a."+u,function(a){a.preventDefault();var n=e(this),o=n.siblings(".dttree-node"),r=o.attr("href");n.children("i").hasClass(t.opts.classes.expandedToggler)?t.collapse(r):t.expand(r)})},_renderNodes:function(t){if(t.length>0){var a=this._create(d);for(i=0;i<t.length;i++)if("dir"===t[i].type){var n=this._renderNode(t[i]);e(a).append(n)}return a}return null},_renderNode:function(e){var t=e.path,a=e.label;t="/"===t?"":t;var n=this._create("A",{href:"#/"+t}).addClass("dttree-node").append(" "+a),o=this._createNodeToggler(e),r=this._create(c).append(o).append(n);if("array"==typeof e.nodes){var s=this._renderNodes(e.nodes);r.append(s)}return r},_createNodeToggler:function(e){var t=this._create("I").addClass(this.opts.classes.collapsedToggler),a=this._create("A",{href:"#"}).addClass(u).append(t).data("node",e);return a},_create:function(t,a){var n=document.createElement(t);return"undefined"!=typeof a&&e.each(a,function(t,a){e(n).attr(t,a)}),e(n)},setChildren:function(t,a){if("undefined"==typeof a)var n=this.element;else var o=e('a[href="#'+a+'"].dttree-node',this.el),n=o.parent("li");n.children("ul").remove();var r=this._renderNodes(t);e(r).hide(),n.append(r)},collapse:function(t){t=this._sanitizePath(t);var a=e('a[href="'+t+'"]',this.el),n=e(a).siblings(".dttree-node-toggler").children("i");n.removeClass(this.opts.classes.expandedToggler),n.addClass(this.opts.classes.collapsedToggler),e(a).siblings("ul").slideUp("fast")},expand:function(t){t=this._sanitizePath(t);var a=e('a[href="'+t+'"]',this.el);e.isFunction(this.opts.onBeforeExpand)&&this.opts.onBeforeExpand(t,this);var n=e(a).siblings(".dttree-node-toggler").children("i");n.removeClass(this.opts.classes.collapsedToggler),n.addClass(this.opts.classes.expandedToggler),e(a).siblings("ul").slideDown("fast")},_sanitizePath:function(e){return"#"==e[0]?e:"#"+e}},l={},e.newPlugin(o,r,s,l)}(jQuery,window,document),DTFINDER.File={url:null,data:{},list:function(e){var t={op:"ls",path:e};return this._sendRequest("GET",t,!0)},move:function(e,t){var a={op:"move",path:e,dest:t};return this._sendRequest("POST",a)},rename:function(e,t){var a={op:"rename",path:e,newName:t};return this._sendRequest("POST",a)},"delete":function(e){var t={op:"delete",path:e};return this._sendRequest("POST",t,!0)},properties:function(e){var t={op:"properties",path:e};return this._sendRequest("GET",t,!0)},search:function(e,t){var a={op:"search",path:t,q:e};return this._sendRequest("GET",a,!0)},_sendRequest:function(e,t,a){t=$.extend(t,this.data);var n=$.ajax({url:this.url,data:t,type:e,async:!1});if("undefined"!=typeof a&&a===!0){var o;return n.done(function(e){o=e}),o}}},function(e,t,a,n){var o,r,s,l;o="dtfinder",r={url:null,locale:"en",manage:!0,upload:!0,uploadUrl:null,width:"100%",height:600,onSelect:!1,permissions:{create:!0,"delete":!0,move:!0},data:{}},s={_init:function(){this._currentPath="/",this._loadedPaths=[],this._cache=[],DTFINDER.config=this.opts,DTFINDER.config.data=e.extend({},r.data,this.opts.data),DTFINDER.config.permissions=e.extend({},r.permissions,this.opts.permissions),DTFINDER.File.url=this.opts.url,DTFINDER.File.data=this.opts.data,DTFINDER.Locale.locale=this.opts.locale,this.createElements(this.el,this.opts),this.initApp(),this.initTree()},initApp:function(){var e=Backbone.Model.extend({defaults:{thumbnail:"false",base64:"false",type:"file",label:""},idAttribute:"path"}),t=this,a=Backbone.Collection.extend({modal:e,url:t.opts.url});DTFINDER.files=new a,DTFINDER.files.fetch({data:{op:"ls",path:"/"}}),console.log(DTFINDER.files.models)},initTree:function(){var t=this,a=[{path:"/",label:"/",type:"dir"}];this.nav.dttree({nodes:a,onBeforeExpand:function(a,n){if(a=a.substr(1),-1===e.inArray(a,t._loadedPaths)){var o=DTFINDER.File.list(a);t._cache[a]=o,t._loadedPaths.push(a)}n.setChildren(t._cache[a],a),t.handleHight()}})},openRoot:function(){var t=window.location.hash.substr(1);if(t)for(var a=t.split("/"),n="",o="/";0!==a.length;)n=n+a.shift()+"/",n.trim(),"/"!=n&&(o=n.substr(0,n.length-1)),this.nav.dttree("expand",o);else{t="/",window.location.hash="/";e('a[href="#'+t+'"]');this.nav.dttree("expand",t)}this.open(t)},listenUrl:function(){var e=this;window.onpopstate=function(t){var a=window.location.hash.substr(1);e.open(a)}},listenMoveBrowser:function(){var t=e("#dtf-sub-browser-dialog");t.on("click","a.dttree-node",function(a){a.preventDefault();var n=a.currentTarget;t.find(".selected").removeClass("selected"),e(n).addClass("selected")})},listenFileItemClick:function(t,a){e(t).on("click",'li[data-file-type="file"] a',function(e){e.preventDefault()}),e(t).on("click",".dtf-file-item img",function(t){t.preventDefault(),e.isFunction(a.onISelect)&&a.onISelect(t)})},listen:function(e,t){this.listenUrl(),this.listenMoveBrowser(),t.manage&&this.listenContextMenu(e),this.listenCreateFolder(this._currentPath),this.listenUpload(this._currentPath),this.listenRename(),this.listenSearch(),this.listenFileItemClick(e,t)},open:function(t){if(this._currentPath=t,-1===e.inArray(t,this._loadedPaths)){var a=DTFINDER.File.list(t);this._cache[t]=a,this._loadedPaths.push(t)}this.listenUpload(t),this.listenCreateFolder(t),this.updateBrowser(this._cache[t]),this.handleHight();var n=this.getParent(t);t=this.createBreadcrumb(t),e("#dtf-parent-folder").attr("href","#"+n),e("#dtf-breadcrumb").html(t)},createBreadcrumb:function(e){for(var t=e.substr(1).split("/"),a="#",n="",o=0;o<t.length;o++)a+="/"+t[o],n+='/<a href="'+a+'">'+t[o]+"</a>";return n},getParent:function(e){var t=e.split("/");return t.pop(),t.join("/")?t.join("/"):"/"},listenSearch:function(){var t=this;e(document).on("keyup",".dtf-search-input",function(){var a=e(this).val();if(a.length>0){var n=DTFINDER.File.search(a,t._currentPath);t.updateBrowser(n)}else t.open(t._currentPath)})},listenRename:function(){var t=13,a=27,n=this;e(document).on("keyup",".dt-rename-input",function(o){if((o.keyCode==a||o.which==a)&&(e(o.target).parent().siblings("a").children(".dtf-file-desc").show(),e(o.target).parent().remove()),o.keyCode==t||o.which==t){var r=e(this).data("path"),s=e(this).val();DTFINDER.File.rename(r,s),e(o.target).parent().siblings("a").children(".file-name").text(s).show(),e(o.target).parent().remove(),n.refresh()}}),e(document).on("blur",".dt-rename-input",function(t){e(t.target).parent().siblings("a").children(".dtf-file-desc").show(),e(t.target).parent().remove()})},listenContextMenu:function(t){e(t).contextmenu({onItem:e.proxy(this.handleContext,this),before:function(a,n,o){var r=null;if(e(a.target).hasClass("dtf-context-holder"))e(t).data("context-holder",a.target),r=e(a.target).data("context-target");else{var s=e(a.target).parents();e.each(s,function(a,n){return e(n).hasClass("dtf-context-holder")?(e(t).data("context-holder",n),r=e(n).data("context-target"),!1):void 0})}return null===r?!1:(e(t).data("target",r),!0)}}),e(document).on("click",".dtf-item-context a",function(a){a.preventDefault(),e(t).data("context").show(a)})},listenUpload:function(t){var a=e.extend({path:t,op:"upload"},this.opts.data);e("#dtf-upload-form").ajaxForm({data:a,success:e.proxy(function(a){this.refresh(t);for(var n=0;n<a.length;n++)e(".uploaded").append("<p> New file: "+a[n].uploaded+"</p>")},this)})},listenCreateFolder:function(t){var a=e.extend({path:t,op:"mkdir"},this.opts.data);e("#dtf-new-folder-form").ajaxForm({data:a,success:e.proxy(function(a){this.refresh(t),e("#dtf-new-folder-dialog").modal("hide")},this)})},handleHight:function(){var t=e(".dtf-area").height();e(".dtf-nav").height(t)},handleContext:function(t,a){a.preventDefault();var n=e(a.target).parent().data("action");if(t.hasClass("dtf-mobile-item-context"))var o=e(t).closest("li.dtf-context-holder");else var o=e(t).data("context-holder");var r=e(o).children("a").attr("href");switch(n){case"delete":if(!confirm("Are you sure you want to delete "+r+" ?, this cannot be undone."))return!1;DTFINDER.File["delete"](r);this.refresh();break;case"rename":var s=e(o).find(".dtf-file-desc"),l=s.text();s.hide(),e(o).append('<div><input data-path="'+r+'" type="text" class="dt-rename-input" value="'+l+'"></div>'),e(o).find(".dt-rename-input").select();break;case"new-folder":return e("#dtf-new-folder-dialog").on("shown.bs.modal",function(){e(".new-folder-input").select()}),void e("#dtf-new-folder-dialog").modal("show");case"move":e("#dtf-sub-browser-dialog .modal-body").dttree({nodes:[{path:"/",label:"/",type:"dir"}],onBeforeExpand:function(e,t){e=e.substr(1);var a=DTFINDER.File.list(e);t.setChildren(a,e)}});var i=this;e("#dtf-sub-browser-dialog").on("click",".folder-selector",function(){var t=e("#dtf-sub-browser-dialog").find(".selected").attr("href").substr(1);DTFINDER.File.move(r,t),i.refresh(),e("#dtf-sub-browser-dialog").modal("hide")}),e("#dtf-sub-browser-dialog").modal("show");break;case"properties":r||(r=this._currentPath);var l=DTFINDER.File.properties(r),d=DTFINDER.DOM._render("properties.html",l);e("#properties-dialog").on("shown.bs.modal",function(t){e(this).find(".modal-body").html(d)}),e("#properties-dialog").modal("show")}},updateBrowser:function(t){if(t.length)for(var a=e("<ul/>").addClass("dtf-file-list"),n=0;n<t.length;n++){var o=DTFINDER.DOM.createFileItem(t[n]);a.append(o)}else var a="<p>Folder empty.</p>";e(this.browserArea).html(a)},refresh:function(e){"undefined"==typeof e&&(e=this._currentPath),data=DTFINDER.File.list("/"+e),this._cache[e]=data,this.updateBrowser(data);for(var t=this._loadedPaths.length-1;t--;)this._loadedPaths[t].trim()==e.trim()&&this._loadedPaths.splice(t,1);this._loadedPaths=[],this.nav.dttree("expand",e)},createElements:function(t,a){var n=this.opts.uploadUrl||this.opts.url,o=DTFINDER.DOM.createUploadDialog(n),r=this.opts.createFolderUrl||this.opts.url,s=DTFINDER.DOM.createNewFolderDialog(r),l=DTFINDER.DOM.createItemContext(),i=DTFINDER.DOM.createBrowserContext(),d=DTFINDER.DOM.createSubBrowserDialog(),c=DTFINDER.DOM.createPropertiesDialog();e(t).html(nunjucks.render("template.html")).after(l).after(i).after(o).after(s).after(d).after(c),this.nav=e("#dtf-tree"),this.browserArea=e("#dtf-area")}},l={},e.newPlugin(o,r,s,l)}(jQuery,window,document);