!function(e){var t=Array.prototype;e.newPlugin=function(a,o,n,r){function s(t,n){this.opts=e.extend({},o,n),this.el=t,this._name=a,this._init()}s.prototype._init=e.noop,s.prototype[a]=function(e){if(!e)return this;try{return this[e].apply(this,t.slice.call(arguments,1))}catch(a){}},e.extend(s.prototype,n),r&&(e[a]=r),e.fn[a]=function(){var o,n=t.slice.call(arguments),r="string"==typeof n[0]&&n[0].split(":"),i="object"==typeof n[0]&&n[0],l=n.slice(1),d="get"==r[0];return this.each(function(){var t=e.data(this,a);return t?o=t[a].apply(t,[r[+d]].concat(l)):e.data(this,a,new s(this,i))}),d?o:this}}}(jQuery),window.DTFINDER=function(){return{lang:[],config:{data:{},classes:{},permissions:{}}}}(),DTFINDER.Locale={locale:null,localize:function(e){return"undefined"==typeof DTFINDER.lang[this.locale]?e:"undefined"==typeof DTFINDER.lang[this.locale][e]?("en"!==this.local&&console.warn("Missing translation: '"+e+"' for locale "+this.locale),e):DTFINDER.lang[this.locale][e]}},function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["file-item.html"]=function(){function e(e,t,a,o,n){var r=null,s=null,i="";try{i+='<li class="dtf-file-item dtf-context-holder" data-context-target=\'#item-context-menu\' data-file-type="',i+=o.suppressValue(o.memberLookup(o.contextOrFrameLookup(t,a,"file"),"type",e.opts.autoescape),e.opts.autoescape),i+='">\n    <a tabindex="-1" class="" href="',i+=o.suppressValue("#/"+o.memberLookup(o.contextOrFrameLookup(t,a,"file"),"path",e.opts.autoescape),e.opts.autoescape),i+='">\n        <div class="dtf-file-img">\n            ',"image"==o.memberLookup(o.contextOrFrameLookup(t,a,"file"),"type",e.opts.autoescape)?(i+='\n                <img src="',i+=o.suppressValue(o.memberLookup(o.contextOrFrameLookup(t,a,"file"),"base64",e.opts.autoescape),e.opts.autoescape),i+='" class="ui-li-thumb">\n            '):i+="file"==o.memberLookup(o.contextOrFrameLookup(t,a,"file"),"type",e.opts.autoescape)?'\n                    <i class="fa fa-file-o"></i></div>\n            ':'\n                    <i class="fa fa-folder-o"></i></div>\n            ',i+='\n        </div>\n        <!-- @todo thumb -->\n        <!--<img src="" class="ui-li-thumb">-->\n        <div class="dtf-file-desc">',i+=o.suppressValue(o.memberLookup(o.contextOrFrameLookup(t,a,"file"),"label",e.opts.autoescape),e.opts.autoescape),i+='</div>\n    </a>\n    <span class="dtf-item-context">\n        <a href="#" data-toggle="dropdown"><i class="fa fa-angle-down"></i></a>\n        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">\n            <li><a data-path="',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"path"),e.opts.autoescape),i+='" data-op="rename" class="dtf-mobile-context-action" href="#">',i+=o.suppressValue((r=18,s=100,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["Rename"])),e.opts.autoescape),i+='</a></li>\n            <li><a data-path="',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"path"),e.opts.autoescape),i+='" data-op="move" class="dtf-mobile-context-action" href="#">',i+=o.suppressValue((r=19,s=98,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["Move"])),e.opts.autoescape),i+='</a></li>\n            <li><a data-path="',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"path"),e.opts.autoescape),i+='" data-op="delete" class="dtf-mobile-context-action" href="#">',i+=o.suppressValue((r=20,s=100,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["Delete"])),e.opts.autoescape),i+='</a></li>\n            <li><a data-path="',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"path"),e.opts.autoescape),i+='" data-op="properties" class="dtf-mobile-context-action" href="#">',i+=o.suppressValue((r=21,s=104,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["Properties"])),e.opts.autoescape),i+="</a></li>\n        </ul>\n    </span>\n</li>\n",n(null,i)}catch(l){n(o.handleError(l,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["mobile-context-menu.html"]=function(){function e(e,t,a,o,n){var r=null,s=null,i="";try{i+='<span class="mobile-context-menu dropdown pull-right"><a data-toggle="dropdown" href="#" style="font-size:1.4em"><i class="fa fa-angle-down"></i></a>\n    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">\n        <li><a data-path="',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"path"),e.opts.autoescape),i+='" data-op="rename" class="dtf-mobile-context-action" href="#">',i+=o.suppressValue((r=2,s=96,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["Rename"])),e.opts.autoescape),i+='</a></li>\n        <li><a data-path="',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"path"),e.opts.autoescape),i+='" data-op="move" class="dtf-mobile-context-action" href="#">',i+=o.suppressValue((r=3,s=94,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["Move"])),e.opts.autoescape),i+='</a></li>\n        <li><a data-path="',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"path"),e.opts.autoescape),i+='" data-op="delete" class="dtf-mobile-context-action" href="#">',i+=o.suppressValue((r=4,s=96,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["Delete"])),e.opts.autoescape),i+='</a></li>\n        <li><a data-path="',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"path"),e.opts.autoescape),i+='" data-op="properties" class="dtf-mobile-context-action" href="#">',i+=o.suppressValue((r=5,s=100,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["Properties"])),e.opts.autoescape),i+="</a></li>\n    </ul>\n</span>\n",n(null,i)}catch(l){n(o.handleError(l,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["modal.html"]=function(){function e(e,t,a,o,n){var r=null,s=null,i="";try{i+='<div id="',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"id"),e.opts.autoescape),i+='" class="modal in">\n    <div class="modal-dialog ',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"size"),e.opts.autoescape),i+='">\n        <div class="modal-content">\n            <div class="clearfix">\n                <button style="margin:5px 15px;" aria-label="Close" data-dismiss="modal" class="close" type="button"><span aria-hidden="true">×</span></button>\n            </div>\n            <div class="modal-body">',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"content"),e.opts.autoescape),i+=" </div>\n        </div>\n    </div>\n</div\n",n(null,i)}catch(l){n(o.handleError(l,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["new-folder-form.html"]=function(){function e(e,t,a,o,n){var r=null,s=null,i="";try{i+='<form method="GET" class="form clearfix" id="dtf-new-folder-form" action="',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"createFolderUrl"),e.opts.autoescape),i+='">\n    <label class="control-label">',i+=o.suppressValue((r=1,s=35,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["New Folder"])),e.opts.autoescape),i+='</label>\n    <input type="text" name="folder-name" value="New Folder" class="form-control new-folder-input"/>\n    <input type="submit" class="btn btn-sm btn-primary pull-right" value="',i+=o.suppressValue((r=3,s=76,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["Submit"])),e.opts.autoescape),i+='"/>\n    <a href="javascript:;" class="btn btn-default btn-sm pull-right" data-dismiss="modal">',i+=o.suppressValue((r=4,s=92,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["Cancel"])),e.opts.autoescape),i+="</a>\n</form>\n",n(null,i)}catch(l){n(o.handleError(l,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["sub-browser.html"]=function(){function e(e,t,a,o,n){var r=null,s=null,i="";try{i+='<div><button class="btn btn-xs pull-right btn-primary folder-selector">',i+=o.suppressValue((r=0,s=73,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["Select"])),e.opts.autoescape),i+="</button></div>\n",n(null,i)}catch(l){n(o.handleError(l,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["template.html"]=function(){function e(e,t,a,o,n){var r=null,s=null,i="";try{i+='<div id="dtf">\n    <div class="container">\n        <div class="row dtf-row">\n            <div class="dt-col col-md-6">\n                <a href="#" data-toggle="modal" data-target="#dtf-upload-dialog" class="btn btn-success btn-sm">\n                    <i class="fa fa-upload" style=""></i> Upload\n                </a>\n\n                <a href="#" data-toggle="modal" data-target="#dtf-new-folder-dialog" class="btn btn-default btn-sm">\n                    <i class="fa fa-folder-o"></i> New Folder\n                </a>\n            </div>\n            <div class="dt-col col-md-6">\n                <div class="row">\n                    <div class="col-md-5 col-md-offset-7">\n                        <input class="form-control input-sm dtf-search-input" placeholder="Search" type="search"/>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="row">\n            <div class="col-md-12">\n                <div id="dtf-breadcrumb-container">\n                    <a id="dtf-parent-folder" href="#">\n                        <i class="fa fa-reply"></i>\n                    </a>\n                    <span id="dtf-breadcrumb"> </span>\n                </div>\n            </div>\n        </div>\n        <div class="row">\n            <div class="col-md-12">\n                <div class="dtf-desktop-area">\n                    <div id="dtf-tree"></div>\n                    <div id="dtf-area" class="dtf-context-holder" data-context-target=\'#bro-context-menu\'></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n',n(null,i)}catch(l){n(o.handleError(l,r,s))}}return{root:e}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["upload-form.html"]=function(){function e(e,t,a,o,n){var r=null,s=null,i="";try{i+='<form method="POST" enctype="multipart/form-data" class="form clearfix" id="dtf-upload-form" action="',i+=o.suppressValue(o.contextOrFrameLookup(t,a,"uploadUrl"),e.opts.autoescape),i+='">\n    <input multiple type="file" name="files[]">\n    <div class="uploaded"></div>\n    <input type="submit" class="btn btn-primary btn-sm pull-right" value="',i+=o.suppressValue((r=3,s=76,o.callWrap(o.contextOrFrameLookup(t,a,"_"),"_",["Submit"])),e.opts.autoescape),i+='">\n</form>\n',n(null,i)}catch(l){n(o.handleError(l,r,s))}}return{root:e}}()}(),DTFINDER.DOM={_render:function(e,t){var t=$.extend(t,{_:function(e){return DTFINDER.Locale.localize(e)}});return nunjucks.render(e,t)},create:function(e,t){var a=document.createElement(e);return"undefined"!=typeof t&&$.each(t,function(e,t){$(a).attr(e,t)}),$(a)},createBreadcrumb:function(){return this._render(DTFINDER.Template.breadcrumb())},createToolbar:function(){return this._render(DTFINDER.Template.toolbar())},createUploadDialog:function(e){var t=this._render("upload-form.html",{uploadUrl:e});return this.createModal("dtf-upload-dialog",t)},createNewFolderDialog:function(e){var t={createFolderUrl:e},a=this._render("new-folder-form.html",t);return this.createModal("dtf-new-folder-dialog",a,"modal-sm")},createSubBrowserDialog:function(){var e=this._render("sub-browser.html");return this.createModal("dtf-sub-browser-dialog",e,"modal-sm")},createPropertiesDialog:function(){return this.createModal("properties-dialog","","modal-sm")},createModal:function(e,t,a){var a=a||"";return this._render("modal.html",{id:e,content:t,size:a})},createBrowserContext:function(){var e={};return DTFINDER.config.permissions.create&&(e["new-folder"]=DTFINDER.Locale.localize("New Folder")+"…"),e.properties=DTFINDER.Locale.localize("Properties"),this.createContextMenu("bro-context-menu",e)},createItemContext:function(){var e={};return DTFINDER.config.permissions.move&&(e.rename=DTFINDER.Locale.localize("Rename"),e.move=DTFINDER.Locale.localize("Move")+"…"),DTFINDER.config.permissions["delete"]&&(e["delete"]=DTFINDER.Locale.localize("Delete")+"…"),e.properties=DTFINDER.Locale.localize("Properties"),this.createContextMenu("item-context-menu",e)},createContextMenu:function(e,t){var a=this.create("UL",{role:"menu"}).addClass("dropdown-menu");$.each(t,$.proxy(function(e,t){var o=this.createContextAction(e,t);$(a).append(o)},this));var o=this.create("DIV",{id:e}).append(a);return o},createContextAction:function(e,t){var a=this.create("A",{href:"#"}).text(t),o=this.create("LI",{"data-action":e}).append(a);return o},createFileItem:function(e){return this._render("file-item.html",{file:e})}},function(e,t,a,o){var n,r,s,l,d="UL",c="LI",p="dttree-node-toggler";n="dttree",r={nodes:[],classes:{collapsedToggler:"fa fa-folder-o",expandedToggler:"fa fa-folder-open-o"}},s={_init:function(){this.$el=e(this.el);var t=this._renderNodes(this.opts.nodes);e(this.el).append(t),this._listen()},_listen:function(){var t=this;e(this.el).on("click","a."+p,function(a){a.preventDefault();var o=e(this),n=o.siblings(".dttree-node"),r=n.attr("href");o.children("i").hasClass(t.opts.classes.expandedToggler)?t.collapse(r):t.expand(r)})},_renderNodes:function(t){if(t.length>0){var a=this._create(d);for(i=0;i<t.length;i++)if("dir"===t[i].type){var o=this._renderNode(t[i]);e(a).append(o)}return a}return null},_renderNode:function(e){var t=e.path,a=e.label;t="/"===t?"":t;var o=this._create("A",{href:"#/"+t}).addClass("dttree-node").append(" "+a),n=this._createNodeToggler(e),r=this._create(c).append(n).append(o);if("array"==typeof e.nodes){var s=this._renderNodes(e.nodes);r.append(s)}return r},_createNodeToggler:function(e){var t=this._create("I").addClass(this.opts.classes.collapsedToggler),a=this._create("A",{href:"#"}).addClass(p).append(t).data("node",e);return a},_create:function(t,a){var o=document.createElement(t);return"undefined"!=typeof a&&e.each(a,function(t,a){e(o).attr(t,a)}),e(o)},setChildren:function(t,a){if("undefined"==typeof a)var o=this.element;else var n=e('a[href="#'+a+'"].dttree-node',this.el),o=n.parent("li");o.children("ul").remove();var r=this._renderNodes(t);e(r).hide(),o.append(r)},collapse:function(t){t=this._sanitizePath(t);var a=e('a[href="'+t+'"]',this.el),o=e(a).siblings(".dttree-node-toggler").children("i");o.removeClass(this.opts.classes.expandedToggler),o.addClass(this.opts.classes.collapsedToggler),e(a).siblings("ul").slideUp("fast")},expand:function(t){t=this._sanitizePath(t);var a=e('a[href="'+t+'"]',this.el);e.isFunction(this.opts.onBeforeExpand)&&this.opts.onBeforeExpand(t,this);var o=e(a).siblings(".dttree-node-toggler").children("i");o.removeClass(this.opts.classes.collapsedToggler),o.addClass(this.opts.classes.expandedToggler),e(a).siblings("ul").slideDown("fast")},_sanitizePath:function(e){return"#"==e[0]?e:"#"+e}},l={},e.newPlugin(n,r,s,l)}(jQuery,window,document),DTFINDER.File={url:null,data:{},list:function(e){var t={op:"ls",path:e};return this._sendRequest("GET",t,!0)},move:function(e,t){var a={op:"move",path:e,dest:t};return this._sendRequest("POST",a)},rename:function(e,t){var a={op:"rename",path:e,newName:t};return this._sendRequest("POST",a)},"delete":function(e){var t={op:"delete",path:e};return this._sendRequest("POST",t,!0)},properties:function(e){var t={op:"properties",path:e};return this._sendRequest("GET",t,!0)},search:function(e,t){var a={op:"search",path:t,q:e};return this._sendRequest("GET",a,!0)},_sendRequest:function(e,t,a){t=$.extend(t,this.data);var o=$.ajax({url:this.url,data:t,type:e,async:!1});if("undefined"!=typeof a&&a===!0){var n;return o.done(function(e){n=e}),n}}},DTFINDER.Layout={handleScreenSize:function(){var e=$(window).innerWidth();if(756>=e)$(".dtf-breadcrumb-container").show(),$(".dtf-nav").hide(),$(".toolbar").css({margin:"5px"}),$(".dtf-area").width("98%");else{$(".dtf-breadcrumb-container").hide(),$(".dtf-nav").show(),$(".toolbar").css({margin:"0px"});var t=$(".dtf-browser-container").width()-$(".dtf-nav").width();$(".dtf-area").width(t-35)}},listenWindowResize:function(){var e=this;$(window).resize(function(){e.handleScreenSize()})}},function(e,t,a,o){var n,r,s,i;n="dtfinder",r={url:null,locale:"en",manage:!0,upload:!0,uploadUrl:null,width:"100%",height:600,onSelect:!1,permissions:{create:!0,"delete":!0,move:!0},data:{}},s={_init:function(){this._currentPath="/",this._loadedPaths=[],this._cache=[],DTFINDER.config=this.opts,DTFINDER.config.data=e.extend({},r.data,this.opts.data),DTFINDER.config.permissions=e.extend({},r.permissions,this.opts.permissions),DTFINDER.File.url=this.opts.url,DTFINDER.File.data=this.opts.data,DTFINDER.Locale.locale=this.opts.locale,this.createElements(this.el,this.opts),this.initTree(),this.listen(this.el,this.opts),this.openRoot(),DTFINDER.Layout.handleScreenSize(),DTFINDER.Layout.listenWindowResize()},initTree:function(){var t=[{path:"/",label:"/",type:"dir"}],a=this;this.nav.dttree({nodes:t,onBeforeExpand:function(t,o){if(t=t.substr(1),-1===e.inArray(t,a._loadedPaths)){var n=DTFINDER.File.list(t);a._cache[t]=n,a._loadedPaths.push(t)}o.setChildren(a._cache[t],t),a.handleHight()}})},openRoot:function(){var t=window.location.hash.substr(1);if(t)for(var a=t.split("/"),o="",n="/";0!==a.length;)o=o+a.shift()+"/",o.trim(),"/"!=o&&(n=o.substr(0,o.length-1)),this.nav.dttree("expand",n);else{t="/",window.location.hash="/";e('a[href="#'+t+'"]');this.nav.dttree("expand",t)}this.open(t)},listen:function(t,a){var o=this;window.onpopstate=function(e){var t=window.location.hash.substr(1);o.open(t)},e("#dtf-sub-browser-dialog").on("click","a.dttree-node",function(t){t.preventDefault();var a=t.currentTarget;e("#dtf-sub-browser-dialog").find(".selected").removeClass("selected"),e(a).addClass("selected")}),a.manage&&(this.listenContextMenu(t),this.listenMobileContextMenu()),this.listenCreateFolder(this._currentPath),this.listenUpload(this._currentPath),this.listenRename(),this.listenSearch(),e(t).on("click",'li[data-file-type="file"] a',function(e){e.preventDefault()}),e(t).on("click",".img-item a",function(t){t.preventDefault(),e.isFunction(a.onISelect)&&a.onISelect(t)})},open:function(t){if(this._currentPath=t,-1===e.inArray(t,this._loadedPaths)){var a=DTFINDER.File.list(t);this._cache[t]=a,this._loadedPaths.push(t)}this.listenUpload(t),this.listenCreateFolder(t),this.updateBrowser(this._cache[t]),this.handleHight();var o=this.getParent(t);t=this.createBreadcrumb(t),e("#dtf-parent-folder").attr("href","#"+o),e("#dtf-breadcrumb").html(t)},createBreadcrumb:function(e){for(var t=e.substr(1).split("/"),a="#",o="",n=0;n<t.length;n++)a+="/"+t[n],o+='/<a href="'+a+'">'+t[n]+"</a>";return o},getParent:function(e){var t=e.split("/");return t.pop(),t.join("/")?t.join("/"):"/"},listenSearch:function(){var t=this;e(document).on("keyup",".dtf-search-input",function(){var a=e(this).val();if(a.length>0){var o=DTFINDER.File.search(a,t._currentPath);t.updateBrowser(o)}else t.open(t._currentPath)})},listenRename:function(){var t=13,a=27,o=this;e(document).on("keyup",".dt-rename-input",function(n){if((n.keyCode==a||n.which==a)&&(e(n.target).parent().siblings("a").children(".file-name").show(),e(n.target).parent().remove()),n.keyCode==t||n.which==t){var r=e(this).data("path"),s=e(this).val();DTFINDER.File.rename(r,s),e(n.target).parent().siblings("a").children(".file-name").text(s).show(),e(n.target).parent().remove(),o.refresh()}}),e(document).on("blur",".dt-rename-input",function(t){e(t.target).parent().siblings("a").children(".file-name").show(),e(t.target).parent().remove()})},listenMobileContextMenu:function(t){var a=this;e(document).on("click",".dtf-mobile-context-action",function(t){t.preventDefault();var o=e(this).data("path"),n=e(this).data("op");a.handleMobileContexAction(n,o,e(this))})},handleMobileContexAction:function(t,a,o){var n=o.closest(".dtf-item");switch(t){case"rename":var r=e(n).find(".file-name"),s=r.text();r.hide(),e(n).append('<div><input data-path="'+a+'" type="text" style="height:18px;" class="form-control input-sm dt-rename-input" value="'+s+'"></div>'),e(n).find(".dt-rename-input").select();break;case"delete":if(!confirm("Are you sure you want to delete "+a+" ?, this cannot be undone."))return!1;DTFINDER.File["delete"](a);this.refresh();break;case"move":e("#sub-browser-dialog .modal-body").dttree({nodes:[{path:"/",label:"/",type:"dir"}],onBeforeExpand:function(e,t){e=e.substr(1);var a=DTFINDER.File.list(e);t.setChildren(a,e)}});var i=this;e("#sub-browser-dialog").on("click",".folder-selector",function(){var t=e("#sub-browser-dialog").find(".selected").attr("href").substr(1);DTFINDER.File.move(a,t),i.refresh(),e("#sub-browser-dialog").modal("hide")}),e("#sub-browser-dialog").modal("show");break;case"properties":a||(a=this._currentPath);var s=DTFINDER.File.properties(a),l=["<table>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Name")+"</td><td>"+s.Name+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Type")+"</td><td>"+s.Type+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Size")+"</td><td>"+s.Size+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Location")+"</td><td>"+s.Location+"</td></tr>","</table>"].join("");e("#properties-dialog").on("shown.bs.modal",function(t){e(this).find(".modal-body").html(l)}),e("#properties-dialog").modal("show")}},listenContextMenu:function(t){e(t).contextmenu({onItem:e.proxy(this.handleContext,this),before:function(a,o,n){var r=null;if(e(a.target).hasClass("dtf-context-holder"))e(t).data("context-holder",a.target),r=e(a.target).data("context-target");else{var s=e(a.target).parents();e.each(s,function(a,o){return e(o).hasClass("dtf-context-holder")?(e(t).data("context-holder",o),r=e(o).data("context-target"),!1):void 0})}return null===r?!1:(e(t).data("target",r),!0)}})},listenUpload:function(t){var a=e.extend({path:t,op:"upload"},this.opts.data);e("#dtf-upload-form").ajaxForm({data:a,success:e.proxy(function(a){this.refresh(t);for(var o=0;o<a.length;o++)e(".uploaded").append("<p> New file: "+a[o].uploaded+"</p>")},this)})},listenCreateFolder:function(t){var a=e.extend({path:t,op:"mkdir"},this.opts.data);e("#dtf-new-folder-form").ajaxForm({data:a,success:e.proxy(function(a){this.refresh(t),e("#dtf-new-folder-dialog").modal("hide")},this)})},handleHight:function(){var t=e(".dtf-area").height();e(".dtf-nav").height(t)},handleContext:function(t,a){a.preventDefault();var o=e(a.target).parent().data("action"),n=e(t).data("context-holder"),r=e(n).children("a").attr("href");switch(o){case"delete":if(!confirm("Are you sure you want to delete "+r+" ?, this cannot be undone."))return!1;DTFINDER.File["delete"](r);this.refresh();break;case"rename":var s=e(n).find(".dtf-file-desc"),i=s.text();s.hide(),e(n).find("a").after('<div><input data-path="'+r+'" type="text" class="dt-rename-input" value="'+i+'"></div>'),e(n).find(".dt-rename-input").select();break;case"new-folder":return e("#dtf-new-folder-dialog").on("shown.bs.modal",function(){e(".new-folder-input").select()}),void e("#dtf-new-folder-dialog").modal("show");case"move":e("#dtf-sub-browser-dialog .modal-body").dttree({nodes:[{path:"/",label:"/",type:"dir"}],onBeforeExpand:function(e,t){e=e.substr(1);var a=DTFINDER.File.list(e);t.setChildren(a,e)}});var l=this;e("#dtf-sub-browser-dialog").on("click",".folder-selector",function(){var t=e("#dtf-sub-browser-dialog").find(".selected").attr("href").substr(1);DTFINDER.File.move(r,t),l.refresh(),e("#dtf-sub-browser-dialog").modal("hide")}),e("#dtf-sub-browser-dialog").modal("show");break;case"properties":r||(r=this._currentPath);var i=DTFINDER.File.properties(r),d=["<table>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Name")+"</td><td>"+i.Name+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Type")+"</td><td>"+i.Type+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Size")+"</td><td>"+i.Size+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Location")+"</td><td>"+i.Location+"</td></tr>","</table>"].join("");e("#properties-dialog").on("shown.bs.modal",function(t){e(this).find(".modal-body").html(d)}),e("#properties-dialog").modal("show")}},updateBrowser:function(t){if(t.length)for(var a=e("<ul/>").addClass("dtf-file-list"),o=0;o<t.length;o++){var n=DTFINDER.DOM.createFileItem(t[o]);a.append(n)}else var a="<p>Folder empty.</p>";e(this.browserArea).html(a)},refresh:function(e){"undefined"==typeof e&&(e=this._currentPath),data=DTFINDER.File.list("/"+e),this._cache[e]=data,this.updateBrowser(data);for(var t=this._loadedPaths.length-1;t--;)this._loadedPaths[t].trim()==e.trim()&&this._loadedPaths.splice(t,1);this._loadedPaths=[],this.nav.dttree("expand",e)},createElements:function(t,a){var o=this.opts.uploadUrl||this.opts.url,n=DTFINDER.DOM.createUploadDialog(o),r=this.opts.createFolderUrl||this.opts.url,s=DTFINDER.DOM.createNewFolderDialog(r),i=DTFINDER.DOM.createItemContext(),l=DTFINDER.DOM.createBrowserContext(),d=DTFINDER.DOM.createSubBrowserDialog(),c=DTFINDER.DOM.createPropertiesDialog();e(t).html(nunjucks.render("template.html")).after(n).after(s).after(i).after(l).after(s).after(d).after(c),this.nav=e("#dtf-tree"),this.browserArea=e("#dtf-area")}},i={},e.newPlugin(n,r,s,i)}(jQuery,window,document);