!function(a){var b=Array.prototype;a.newPlugin=function(c,d,e,f){function g(b,e){this.opts=a.extend({},d,e),this.el=b,this._name=c,this._init()}g.prototype._init=a.noop,g.prototype[c]=function(a){if(!a)return this;try{return this[a].apply(this,b.slice.call(arguments,1))}catch(c){}},a.extend(g.prototype,e),f&&(a[c]=f),a.fn[c]=function(){var d,e=b.slice.call(arguments),f="string"==typeof e[0]&&e[0].split(":"),h="object"==typeof e[0]&&e[0],i=e.slice(1),j="get"==f[0];return this.each(function(){var b=a.data(this,c);return b?d=b[c].apply(b,[f[+j]].concat(i)):a.data(this,c,new g(this,h))}),j?d:this}}}(jQuery),DTFINDER={},DTFINDER.lang=[],DTFINDER.config={data:{},classes:{},permissions:{}},DTFINDER.Locale={locale:null,localize:function(a){return"undefined"==typeof DTFINDER.lang[this.locale]?a:"undefined"==typeof DTFINDER.lang[this.locale][a]?("en"!==this.local&&console.warn("Missing translation: '"+a+"' for locale "+this.locale),a):DTFINDER.lang[this.locale][a]}},DTFINDER.Template=function(){var a=function(a){return DTFINDER.Locale.localize(a)};return{breadcrumb:function(){return'<div class="dtf-breadcrumb-container"><div class="col-md-12"><a id="dtf-parent-folder" href="#"><span class="fa-stack fa-lg"> <i class="fa fa-folder-o fa-stack-1x"></i> <i class="fa fa-mail-reply"></i> </span></a><span id="dtf-breadcrumb"></span></div></div>'},toolbar:function(){return'<div class="dtf-toolbar clearfix" style="margin-bottom:5px"><div class="toolbar clearfix col-md-6"><a href="#" data-toggle="modal" data-target="#upload-dialog" class="upload-btn tool btn btn-sm btn-success pull-left"><i class="fa fa-upload"></i> Unggah</a></div><div class="toolbar clearfix col-md-6"><form class="form-inline"><input type="text" name="q" placeholder="Cari" class="input-sm form-control pull-right dt-search-input"></form></div></div>'},modal:function(){return'<div id="{{ id }}" class="modal in"><div class="modal-dialog {{ size }}"><div class="modal-content"><div class="clearfix"><button style="margin:5px 15px;" aria-label="Close" data-dismiss="modal" class="close" type="button"><span aria-hidden="true">×</span></button></div><div class="modal-body">{{{ content }}} </div></div></div></div>'},newFolder:function(){return'<form method="GET" class="form clearfix" id="new-folder-form" action="{{ createFolderUrl }}"><label class="control-label">'+a("New Folder")+'</label><input type="text" name="folder-name" value="New Folder" class="form-control new-folder-input" style="margin-bottom:10px;"/><input type="submit" class="btn btn-sm btn-primary pull-right" value="'+a("Submit")+'"/><a href="javascript:;" class="btn btn-default btn-sm pull-right" data-dismiss="modal" style="margin-right:10px;">'+a("Cancel")+"</a></form>"},uploadForm:function(){return'<form method="POST" enctype="multipart/form-data" class="form clearfix" id="upload-form" action="{{ uploadUrl }}"><input multiple type="file" name="files[]" style="margin-bottom:10px;"><div class="uploaded"></div><input type="submit" class="btn btn-primary btn-sm pull-right" value="'+a("Submit")+'"></form>'},moveBrowser:function(){return'<div><button class="btn btn-xs pull-right btn-primary folder-selector">'+a("Select")+"</button></div>"},mobileContextMenu:function(){return'<span class="mobile-context-menu dropdown"><a data-toggle="dropdown" href="#" style="font-size:1.4em"><i class="fa fa-angle-down"></i></a><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><a data-path="{{ path }}" data-op="rename" class="dtf-mobile-context-action" href="#">'+a("Rename")+'</a></li><li><a data-path="{{ path }}" data-op="move" class="dtf-mobile-context-action" href="#">'+a("Move")+'</a></li><li><a data-path="{{ path }}" data-op="delete" class="dtf-mobile-context-action" href="#">'+a("Delete")+'</a></li><li><a data-path="{{ path }}" data-op="properties" class="dtf-mobile-context-action" href="#">'+a("Properties")+"</a></li></ul></span>"}}}(),DTFINDER.DOM={_render:function(a,b){var c=Handlebars.compile(a,b);return c(b)},create:function(a,b){var c=document.createElement(a);return"undefined"!=typeof b&&$.each(b,function(a,b){$(c).attr(a,b)}),$(c)},createBreadcrumb:function(){return this._render(DTFINDER.Template.breadcrumb())},createToolbar:function(){return this._render(DTFINDER.Template.toolbar())},createUploadDialog:function(a){var b=this._render(DTFINDER.Template.uploadForm(),{uploadUrl:a});return this.createModal("upload-dialog",b)},createNewFolderDialog:function(a){var b={createFolderUrl:a},c=this._render(DTFINDER.Template.newFolder(),b);return this.createModal("new-folder-dialog",c,"modal-sm")},createSubBrowserDialog:function(){var a=this._render(DTFINDER.Template.moveBrowser());return this.createModal("sub-browser-dialog",a,"modal-sm")},createPropertiesDialog:function(){return this.createModal("properties-dialog","","modal-sm")},createModal:function(a,b,c){var c=c||"";return this._render(DTFINDER.Template.modal(),{id:a,content:b,size:c})},createBrowserContext:function(){var a={};return DTFINDER.config.permissions.create&&(a["new-folder"]=DTFINDER.Locale.localize("New Folder")+"…"),a.properties=DTFINDER.Locale.localize("Properties"),this.createContextMenu("bro-context-menu",a)},createItemContext:function(){var a={};return DTFINDER.config.permissions.move&&(a.rename=DTFINDER.Locale.localize("Rename"),a.move=DTFINDER.Locale.localize("Move")+"…"),DTFINDER.config.permissions["delete"]&&(a["delete"]=DTFINDER.Locale.localize("Delete")+"…"),a.properties=DTFINDER.Locale.localize("Properties"),this.createContextMenu("item-context-menu",a)},createContextMenu:function(a,b){var c=this.create("UL",{role:"menu"}).addClass("dropdown-menu");$.each(b,$.proxy(function(a,b){var d=this.createContextAction(a,b);$(c).append(d)},this));var d=this.create("DIV",{id:a}).append(c);return d},createContextAction:function(a,b){var c=this.create("A",{href:"#"}).text(b),d=this.create("LI",{"data-action":a}).append(c);return d},createFileItem:function(a){var b=this.create("LI").addClass("dtf-item dtf-context-holder");if(b.data("context-target","#item-context-menu"),"image"==a.type){var c=this.create("IMG",{src:a.base64}).addClass("icon");$(b).addClass("img-item")}else{if("file"==a.type){var d="fa fa-file-o";$(b).addClass("dtf-file-item")}else if("dir"==a.type){var d="fa fa-folder-o";$(b).addClass("dtf-folder-item")}else var d=null;var c=this.create("I").addClass("icon").addClass(d)}var e=this.create("A",{href:"#/"+a.path}).append(c).append('<span style="overflow: hidden;text-overflow: ellipsis;" class="file-name">'+a.label+"</span>"),f=this._render(DTFINDER.Template.mobileContextMenu(),{path:a.path});return $(b).append(e).append(f),b}},function(a){var b,c,d,e,f="UL",g="LI",h="dttree-node-toggler";b="dttree",c={nodes:[],classes:{collapsedToggler:"fa fa-folder-o",expandedToggler:"fa fa-folder-open-o"}},d={_init:function(){this.$el=a(this.el);var b=this._renderNodes(this.opts.nodes);a(this.el).append(b),this._listen()},_listen:function(){var b=this;a(this.el).on("click","a."+h,function(c){c.preventDefault();var d=a(this),e=d.siblings(".dttree-node"),f=e.attr("href");d.children("i").hasClass(b.opts.classes.expandedToggler)?b.collapse(f):b.expand(f)})},_renderNodes:function(b){if(b.length>0){var c=this._create(f);for(i=0;i<b.length;i++)if("dir"===b[i].type){var d=this._renderNode(b[i]);a(c).append(d)}return c}return null},_renderNode:function(a){var b=a.path,c=a.label;b="/"===b?"":b;var d=this._create("A",{href:"#/"+b}).addClass("dttree-node").append(" "+c),e=this._createNodeToggler(a),f=this._create(g).append(e).append(d);if("array"==typeof a.nodes){var h=this._renderNodes(a.nodes);f.append(h)}return f},_createNodeToggler:function(a){var b=this._create("I").addClass(this.opts.classes.collapsedToggler),c=this._create("A",{href:"#"}).addClass(h).append(b).data("node",a);return c},_create:function(b,c){var d=document.createElement(b);return"undefined"!=typeof c&&a.each(c,function(b,c){a(d).attr(b,c)}),a(d)},setChildren:function(b,c){if("undefined"==typeof c)var d=this.element;else var e=a('a[href="#'+c+'"].dttree-node',this.el),d=e.parent("li");d.children("ul").remove();var f=this._renderNodes(b);a(f).hide(),d.append(f)},collapse:function(b){b=this._sanitizePath(b);var c=a('a[href="'+b+'"]',this.el),d=a(c).siblings(".dttree-node-toggler").children("i");d.removeClass(this.opts.classes.expandedToggler),d.addClass(this.opts.classes.collapsedToggler),a(c).siblings("ul").slideUp("fast")},expand:function(b){b=this._sanitizePath(b);var c=a('a[href="'+b+'"]',this.el);a.isFunction(this.opts.onBeforeExpand)&&this.opts.onBeforeExpand(b,this);var d=a(c).siblings(".dttree-node-toggler").children("i");d.removeClass(this.opts.classes.collapsedToggler),d.addClass(this.opts.classes.expandedToggler),a(c).siblings("ul").slideDown("fast")},_sanitizePath:function(a){return"#"==a[0]?a:"#"+a}},e={},a.newPlugin(b,c,d,e)}(jQuery,window,document),DTFINDER.File={url:null,data:{},list:function(a){var b={op:"ls",path:a};return this._sendRequest("GET",b,!0)},move:function(a,b){var c={op:"move",path:a,dest:b};return this._sendRequest("POST",c)},rename:function(a,b){var c={op:"rename",path:a,newName:b};return this._sendRequest("POST",c)},"delete":function(a){var b={op:"delete",path:a};return this._sendRequest("POST",b,!0)},properties:function(a){var b={op:"properties",path:a};return this._sendRequest("GET",b,!0)},search:function(a,b){var c={op:"search",path:b,q:a};return this._sendRequest("GET",c,!0)},_sendRequest:function(a,b,c){b=$.extend(b,this.data);var d=$.ajax({url:this.url,data:b,type:a,async:!1});if("undefined"!=typeof c&&c===!0){var e;return d.done(function(a){e=a}),e}}},DTFINDER.Layout={handleScreenSize:function(){var a=$(window).innerWidth();if(756>=a)$(".dtf-nav").hide(),$(".toolbar").css({margin:"5px"}),$(".dtf-area").width("98%");else{$(".dtf-nav").show(),$(".toolbar").css({margin:"0px"});var b=$(".dtf-browser-container").width()-$(".dtf-nav").width();$(".dtf-area").width(b-20)}},listenWindowResize:function(){var a=this;$(window).resize(function(){a.handleScreenSize()})}},function(a){var b,c,d,e;b="dtfinder",c={url:null,locale:"en",manage:!0,upload:!0,uploadUrl:null,width:"100%",height:600,onSelect:!1,permissions:{create:!0,"delete":!0,move:!0},data:{}},d={_init:function(){this._currentPath="/",this._loadedPaths=[],this._cache=[],DTFINDER.config=this.opts,DTFINDER.config.data=a.extend({},c.data,this.opts.data),DTFINDER.config.permissions=a.extend({},c.permissions,this.opts.permissions),DTFINDER.File.url=this.opts.url,DTFINDER.File.data=this.opts.data,DTFINDER.Locale.locale=this.opts.locale,this.createElements(this.el,this.opts),this.initTree(),this.listen(this.el,this.opts),this.openRoot(),DTFINDER.Layout.handleScreenSize(),DTFINDER.Layout.listenWindowResize()},initTree:function(){var b=[{path:"/",label:"/",type:"dir"}],c=this;this.nav.dttree({nodes:b,onBeforeExpand:function(b,d){if(b=b.substr(1),-1===a.inArray(b,c._loadedPaths)){var e=DTFINDER.File.list(b);c._cache[b]=e,c._loadedPaths.push(b)}d.setChildren(c._cache[b],b),c.handleHight()}})},openRoot:function(){var b=window.location.hash.substr(1);if(b)for(var c=b.split("/"),d="",e="/";0!==c.length;)d=d+c.shift()+"/",d.trim(),"/"!=d&&(e=d.substr(0,d.length-1)),this.nav.dttree("expand",e);else{b="/",window.location.hash="/";{a('a[href="#'+b+'"]')}this.nav.dttree("expand",b)}this.open(b)},listen:function(b,c){var d=this;window.onpopstate=function(){var a=window.location.hash.substr(1);d.open(a)},a("#sub-browser-dialog").on("click","a.dttree-node",function(b){b.preventDefault();var c=b.currentTarget;a("#sub-browser-dialog").find(".selected").removeClass("selected"),a(c).addClass("selected")}),c.manage&&(this.listenContextMenu(b),this.listenMobileContextMenu()),this.listenUpload(this._currentPath),this.listenCreateFolder(this._currentPath),this.listenRename(),this.listenSearch(),a(b).on("click",".dtf-file-item a",function(a){a.preventDefault()}),a(b).on("click",".img-item a",function(b){b.preventDefault(),a.isFunction(c.onISelect)&&c.onISelect(b)})},open:function(b){if(this._currentPath=b,-1===a.inArray(b,this._loadedPaths)){var c=DTFINDER.File.list(b);this._cache[b]=c,this._loadedPaths.push(b)}this.listenUpload(b),this.listenCreateFolder(b),this.updateBrowser(this._cache[b]),this.handleHight();var d=this.getParent(b);b=this.createBreadcrumb(b),a("#dtf-parent-folder").attr("href","#"+d),a("#dtf-breadcrumb").html(b)},createBreadcrumb:function(a){for(var b=a.substr(1).split("/"),c="#",d="",e=0;e<b.length;e++)c+="/"+b[e],d+='/<a href="'+c+'">'+b[e]+"</a>";return d},getParent:function(a){var b=a.split("/");return b.pop(),b.join("/")?b.join("/"):"/"},listenSearch:function(){var b=this;a(document).on("keyup",".dt-search-input",function(){var c=a(this).val();if(c.length>0){var d=DTFINDER.File.search(c,b._currentPath);b.updateBrowser(d)}else b.open(b._currentPath)})},listenRename:function(){var b=13,c=27,d=this;a(document).on("keyup",".dt-rename-input",function(e){if((e.keyCode==c||e.which==c)&&(a(e.target).parent().siblings("a").children(".file-name").show(),a(e.target).parent().remove()),e.keyCode==b||e.which==b){var f=a(this).data("path"),g=a(this).val();DTFINDER.File.rename(f,g),a(e.target).parent().siblings("a").children(".file-name").text(g).show(),a(e.target).parent().remove(),d.refresh()}}),a(document).on("blur",".dt-rename-input",function(b){a(b.target).parent().siblings("a").children(".file-name").show(),a(b.target).parent().remove()})},listenMobileContextMenu:function(){var b=this;a(document).on("click",".dtf-mobile-context-action",function(c){c.preventDefault();var d=a(this).data("path"),e=a(this).data("op");b.handleMobileContexAction(e,d,a(this))})},handleMobileContexAction:function(b,c,d){var e=d.closest(".dtf-item");switch(b){case"rename":var f=a(e).find(".file-name"),g=f.text();f.hide(),a(e).append('<div><input data-path="'+c+'" type="text" style="height:18px;" class="form-control input-sm dt-rename-input" value="'+g+'"></div>'),a(e).find(".dt-rename-input").select();break;case"delete":if(!confirm("Are you sure you want to delete "+c+" ?, this cannot be undone."))return!1;{DTFINDER.File["delete"](c)}this.refresh();break;case"move":a("#sub-browser-dialog .modal-body").dttree({nodes:[{path:"/",label:"/",type:"dir"}],onBeforeExpand:function(a,b){a=a.substr(1);var c=DTFINDER.File.list(a);b.setChildren(c,a)}});var h=this;a("#sub-browser-dialog").on("click",".folder-selector",function(){var b=a("#sub-browser-dialog").find(".selected").attr("href").substr(1);DTFINDER.File.move(c,b),h.refresh(),a("#sub-browser-dialog").modal("hide")}),a("#sub-browser-dialog").modal("show");break;case"properties":c||(c=this._currentPath);var g=DTFINDER.File.properties(c),i=["<table>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Name")+"</td><td>"+g.Name+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Type")+"</td><td>"+g.Type+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Size")+"</td><td>"+g.Size+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Location")+"</td><td>"+g.Location+"</td></tr>","</table>"].join("");a("#properties-dialog").on("shown.bs.modal",function(){a(this).find(".modal-body").html(i)}),a("#properties-dialog").modal("show")}},listenContextMenu:function(b){a(b).contextmenu({onItem:a.proxy(this.handleContext,this),before:function(c){var d=null;if(a(c.target).hasClass("dtf-context-holder"))a(b).data("context-holder",c.target),d=a(c.target).data("context-target");else{var e=a(c.target).parents();a.each(e,function(c,e){return a(e).hasClass("dtf-context-holder")?(a(b).data("context-holder",e),d=a(e).data("context-target"),!1):void 0})}return null===d?!1:(a(b).data("target",d),!0)}})},listenUpload:function(b){var c=a.extend({path:b,op:"upload"},this.opts.data);a("#upload-form").ajaxForm({data:c,success:a.proxy(function(c){this.refresh(b);for(var d=0;d<c.length;d++)a(".uploaded").append("<p> New file: "+c[d].uploaded+"</p>")},this)})},listenCreateFolder:function(b){var c=a.extend({path:b,op:"mkdir"},this.opts.data);a("#new-folder-form").ajaxForm({data:c,success:a.proxy(function(){this.refresh(b),a("#new-folder-dialog").modal("hide")},this)})},handleHight:function(){var b=a(".dtf-area").height();a(".dtf-nav").height(b)},handleContext:function(b,c){c.preventDefault();var d=a(c.target).parent().data("action"),e=a(b).data("context-holder"),f=a(e).children("a").attr("href");switch(d){case"delete":if(!confirm("Are you sure you want to delete "+f+" ?, this cannot be undone."))return!1;{DTFINDER.File["delete"](f)}this.refresh();break;case"rename":var g=a(e).find(".file-name"),h=g.text();g.hide(),a(e).append('<div><input data-path="'+f+'" type="text" style="height:18px;" class="form-control input-sm dt-rename-input" value="'+h+'"></div>'),a(e).find(".dt-rename-input").select();break;case"new-folder":return a("#new-folder-dialog").on("shown.bs.modal",function(){a(".new-folder-input").select()}),void a("#new-folder-dialog").modal("show");case"move":a("#sub-browser-dialog .modal-body").dttree({nodes:[{path:"/",label:"/",type:"dir"}],onBeforeExpand:function(a,b){a=a.substr(1);var c=DTFINDER.File.list(a);b.setChildren(c,a)}});var i=this;a("#sub-browser-dialog").on("click",".folder-selector",function(){var b=a("#sub-browser-dialog").find(".selected").attr("href").substr(1);DTFINDER.File.move(f,b),i.refresh(),a("#sub-browser-dialog").modal("hide")}),a("#sub-browser-dialog").modal("show");break;case"properties":f||(f=this._currentPath);var h=DTFINDER.File.properties(f),j=["<table>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Name")+"</td><td>"+h.Name+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Type")+"</td><td>"+h.Type+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Size")+"</td><td>"+h.Size+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Location")+"</td><td>"+h.Location+"</td></tr>","</table>"].join("");a("#properties-dialog").on("shown.bs.modal",function(){a(this).find(".modal-body").html(j)}),a("#properties-dialog").modal("show")}},updateBrowser:function(b){for(var c=a("<ul/>"),d=0;d<b.length;d++){var e=DTFINDER.DOM.createFileItem(b[d]);a(c).append(e)}a(this.browserArea).html(c)},refresh:function(a){"undefined"==typeof a&&(a=this._currentPath),data=DTFINDER.File.list("/"+a),this._cache[a]=data,this.updateBrowser(data);for(var b=this._loadedPaths.length-1;b--;)this._loadedPaths[b].trim()==a.trim()&&this._loadedPaths.splice(b,1);this._loadedPaths=[],this.nav.dttree("expand",a)},createElements:function(b){this.nav=a("<div/>").addClass("dtf-nav"),this.browserArea=a("<div/>").addClass("dtf-area ctn dtf-context-holder").data("context-target","#bro-context-menu"),this.navMobile=DTFINDER.DOM.createBreadcrumb();var c=a("<div/>").addClass("dtf-browser-container clearfix").css({width:"100%"}),d=a("<div/>").addClass("dtf-contianer clearfix"),e=DTFINDER.DOM.createToolbar(),f=this.opts.uploadUrl||this.opts.url,g=DTFINDER.DOM.createUploadDialog(f),h=this.opts.createFolderUrl||this.opts.url,i=DTFINDER.DOM.createNewFolderDialog(h),j=DTFINDER.DOM.createSubBrowserDialog(),k=DTFINDER.DOM.createPropertiesDialog(),l=DTFINDER.DOM.createItemContext(),m=DTFINDER.DOM.createBrowserContext();a(c).append(this.nav).append(this.browserArea),a(d).append(e).append(this.navMobile).append(c),a(b).append(d).after(l).after(m).after(g).after(i).after(j).after(k)}},e={},a.newPlugin(b,c,d,e)}(jQuery,window,document);