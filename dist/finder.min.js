!function(e){var t=Array.prototype;e.newPlugin=function(a,r,n,o){function i(t,n){this.opts=e.extend({},r,n),this.el=t,this._name=a,this._init()}i.prototype._init=e.noop,i.prototype[a]=function(e){if(!e)return this;try{return this[e].apply(this,t.slice.call(arguments,1))}catch(a){}},e.extend(i.prototype,n),o&&(e[a]=o),e.fn[a]=function(){var r,n=t.slice.call(arguments),o="string"==typeof n[0]&&n[0].split(":"),s="object"==typeof n[0]&&n[0],l=n.slice(1),d="get"==o[0];return this.each(function(){var t=e.data(this,a);return t?r=t[a].apply(t,[o[+d]].concat(l)):e.data(this,a,new i(this,s))}),d?r:this}}}(jQuery),DTFINDER={},DTFINDER.lang=[],DTFINDER.config={data:{},classes:{},permissions:{}},DTFINDER.Locale={locale:null,localize:function(e){return"undefined"==typeof DTFINDER.lang[this.locale]?e:"undefined"==typeof DTFINDER.lang[this.locale][e]?("en"!==this.local&&console.warn("Missing translation: '"+e+"' for locale "+this.locale),e):DTFINDER.lang[this.locale][e]}},DTFINDER.Template=function(){var e=function(e){return DTFINDER.Locale.localize(e)};return{breadcrumb:function(){return'<div class="dtf-breadcrumb-container row"><div class="col-md-12"><a id="dtf-parent-folder" href="#"><i class="fa fa-reply"></i> </a><span id="dtf-breadcrumb"></span></div></div>'},toolbar:function(){return'<div class="dtf-toolbar clearfix" style="margin-bottom:10px"><a href="#" data-toggle="modal" data-target="#upload-dialog" class="upload-btn tool btn btn-sm btn-success pull-left"><i class="fa fa-upload"></i> '+e("Upload")+'</a><a href="#" data-toggle="modal" data-target="#new-folder-dialog" class="btn btn-sm btn-default pull-left new-folder-btn">'+e("New Folder")+'</a><form class="form-inline"><input type="text" name="q" placeholder="Cari" class="input-sm form-control pull-right dt-search-input"></form></div>'},modal:function(){return'<div id="{{ id }}" class="modal in"><div class="modal-dialog {{ size }}"><div class="modal-content"><div class="clearfix"><button style="margin:5px 15px;" aria-label="Close" data-dismiss="modal" class="close" type="button"><span aria-hidden="true">×</span></button></div><div class="modal-body">{{{ content }}} </div></div></div></div>'},newFolder:function(){return'<form method="GET" class="form clearfix" id="new-folder-form" action="{{ createFolderUrl }}"><label class="control-label">'+e("New Folder")+'</label><input type="text" name="folder-name" value="New Folder" class="form-control new-folder-input" style="margin-bottom:10px;"/><input type="submit" class="btn btn-sm btn-primary pull-right" value="'+e("Submit")+'"/><a href="javascript:;" class="btn btn-default btn-sm pull-right" data-dismiss="modal" style="margin-right:10px;">'+e("Cancel")+"</a></form>"},uploadForm:function(){return'<form method="POST" enctype="multipart/form-data" class="form clearfix" id="upload-form" action="{{ uploadUrl }}"><input multiple type="file" name="files[]" style="margin-bottom:10px;"><div class="uploaded"></div><input type="submit" class="btn btn-primary btn-sm pull-right" value="'+e("Submit")+'"></form>'},moveBrowser:function(){return'<div><button class="btn btn-xs pull-right btn-primary folder-selector">'+e("Select")+"</button></div>"},mobileContextMenu:function(){return'<span class="mobile-context-menu dropdown pull-right"><a data-toggle="dropdown" href="#" style="font-size:1.4em"><i class="fa fa-angle-down"></i></a><ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><a data-path="{{ path }}" data-op="rename" class="dtf-mobile-context-action" href="#">'+e("Rename")+'</a></li><li><a data-path="{{ path }}" data-op="move" class="dtf-mobile-context-action" href="#">'+e("Move")+'</a></li><li><a data-path="{{ path }}" data-op="delete" class="dtf-mobile-context-action" href="#">'+e("Delete")+'</a></li><li><a data-path="{{ path }}" data-op="properties" class="dtf-mobile-context-action" href="#">'+e("Properties")+"</a></li></ul></span>"}}}(),DTFINDER.DOM={_render:function(e,t){var a=Handlebars.compile(e,t);return a(t)},create:function(e,t){var a=document.createElement(e);return"undefined"!=typeof t&&$.each(t,function(e,t){$(a).attr(e,t)}),$(a)},createBreadcrumb:function(){return this._render(DTFINDER.Template.breadcrumb())},createToolbar:function(){return this._render(DTFINDER.Template.toolbar())},createUploadDialog:function(e){var t=this._render(DTFINDER.Template.uploadForm(),{uploadUrl:e});return this.createModal("upload-dialog",t)},createNewFolderDialog:function(e){var t={createFolderUrl:e},a=this._render(DTFINDER.Template.newFolder(),t);return this.createModal("new-folder-dialog",a,"modal-sm")},createSubBrowserDialog:function(){var e=this._render(DTFINDER.Template.moveBrowser());return this.createModal("sub-browser-dialog",e,"modal-sm")},createPropertiesDialog:function(){return this.createModal("properties-dialog","","modal-sm")},createModal:function(e,t,a){var a=a||"";return this._render(DTFINDER.Template.modal(),{id:e,content:t,size:a})},createBrowserContext:function(){var e={};return DTFINDER.config.permissions.create&&(e["new-folder"]=DTFINDER.Locale.localize("New Folder")+"…"),e.properties=DTFINDER.Locale.localize("Properties"),this.createContextMenu("bro-context-menu",e)},createItemContext:function(){var e={};return DTFINDER.config.permissions.move&&(e.rename=DTFINDER.Locale.localize("Rename"),e.move=DTFINDER.Locale.localize("Move")+"…"),DTFINDER.config.permissions["delete"]&&(e["delete"]=DTFINDER.Locale.localize("Delete")+"…"),e.properties=DTFINDER.Locale.localize("Properties"),this.createContextMenu("item-context-menu",e)},createContextMenu:function(e,t){var a=this.create("UL",{role:"menu"}).addClass("dropdown-menu");$.each(t,$.proxy(function(e,t){var r=this.createContextAction(e,t);$(a).append(r)},this));var r=this.create("DIV",{id:e}).append(a);return r},createContextAction:function(e,t){var a=this.create("A",{href:"#"}).text(t),r=this.create("LI",{"data-action":e}).append(a);return r},createFileItem:function(e){var t=this.create("LI").addClass("dtf-item dtf-context-holder");if(t.data("context-target","#item-context-menu"),"image"==e.type){var a=this.create("IMG",{src:e.base64}).addClass("icon");$(t).addClass("img-item")}else{if("file"==e.type){var r="fa fa-file-o";$(t).addClass("dtf-file-item")}else if("dir"==e.type){var r="fa fa-folder-o";$(t).addClass("dtf-folder-item")}else var r=null;var a=this.create("I").addClass("icon").addClass(r)}var n=this.create("A",{href:"#/"+e.path}).append(a).append('<span style="overflow: hidden;text-overflow: ellipsis;" class="file-name">'+e.label+"</span>"),o=this._render(DTFINDER.Template.mobileContextMenu(),{path:e.path});return $(t).append(n).append(o),t}},function(e,t,a,r){var n,o,s,l,d="UL",c="LI",p="dttree-node-toggler";n="dttree",o={nodes:[],classes:{collapsedToggler:"fa fa-folder-o",expandedToggler:"fa fa-folder-open-o"}},s={_init:function(){this.$el=e(this.el);var t=this._renderNodes(this.opts.nodes);e(this.el).append(t),this._listen()},_listen:function(){var t=this;e(this.el).on("click","a."+p,function(a){a.preventDefault();var r=e(this),n=r.siblings(".dttree-node"),o=n.attr("href");r.children("i").hasClass(t.opts.classes.expandedToggler)?t.collapse(o):t.expand(o)})},_renderNodes:function(t){if(t.length>0){var a=this._create(d);for(i=0;i<t.length;i++)if("dir"===t[i].type){var r=this._renderNode(t[i]);e(a).append(r)}return a}return null},_renderNode:function(e){var t=e.path,a=e.label;t="/"===t?"":t;var r=this._create("A",{href:"#/"+t}).addClass("dttree-node").append(" "+a),n=this._createNodeToggler(e),o=this._create(c).append(n).append(r);if("array"==typeof e.nodes){var i=this._renderNodes(e.nodes);o.append(i)}return o},_createNodeToggler:function(e){var t=this._create("I").addClass(this.opts.classes.collapsedToggler),a=this._create("A",{href:"#"}).addClass(p).append(t).data("node",e);return a},_create:function(t,a){var r=document.createElement(t);return"undefined"!=typeof a&&e.each(a,function(t,a){e(r).attr(t,a)}),e(r)},setChildren:function(t,a){if("undefined"==typeof a)var r=this.element;else var n=e('a[href="#'+a+'"].dttree-node',this.el),r=n.parent("li");r.children("ul").remove();var o=this._renderNodes(t);e(o).hide(),r.append(o)},collapse:function(t){t=this._sanitizePath(t);var a=e('a[href="'+t+'"]',this.el),r=e(a).siblings(".dttree-node-toggler").children("i");r.removeClass(this.opts.classes.expandedToggler),r.addClass(this.opts.classes.collapsedToggler),e(a).siblings("ul").slideUp("fast")},expand:function(t){t=this._sanitizePath(t);var a=e('a[href="'+t+'"]',this.el);e.isFunction(this.opts.onBeforeExpand)&&this.opts.onBeforeExpand(t,this);var r=e(a).siblings(".dttree-node-toggler").children("i");r.removeClass(this.opts.classes.collapsedToggler),r.addClass(this.opts.classes.expandedToggler),e(a).siblings("ul").slideDown("fast")},_sanitizePath:function(e){return"#"==e[0]?e:"#"+e}},l={},e.newPlugin(n,o,s,l)}(jQuery,window,document),DTFINDER.File={url:null,data:{},list:function(e){var t={op:"ls",path:e};return this._sendRequest("GET",t,!0)},move:function(e,t){var a={op:"move",path:e,dest:t};return this._sendRequest("POST",a)},rename:function(e,t){var a={op:"rename",path:e,newName:t};return this._sendRequest("POST",a)},"delete":function(e){var t={op:"delete",path:e};return this._sendRequest("POST",t,!0)},properties:function(e){var t={op:"properties",path:e};return this._sendRequest("GET",t,!0)},search:function(e,t){var a={op:"search",path:t,q:e};return this._sendRequest("GET",a,!0)},_sendRequest:function(e,t,a){t=$.extend(t,this.data);var r=$.ajax({url:this.url,data:t,type:e,async:!1});if("undefined"!=typeof a&&a===!0){var n;return r.done(function(e){n=e}),n}}},DTFINDER.Layout={handleScreenSize:function(){var e=$(window).innerWidth();if(756>=e)$(".dtf-breadcrumb-container").show(),$(".dtf-nav").hide(),$(".toolbar").css({margin:"5px"}),$(".dtf-area").width("98%");else{$(".dtf-breadcrumb-container").hide(),$(".dtf-nav").show(),$(".toolbar").css({margin:"0px"});var t=$(".dtf-browser-container").width()-$(".dtf-nav").width();$(".dtf-area").width(t-35)}},listenWindowResize:function(){var e=this;$(window).resize(function(){e.handleScreenSize()})}},function(e,t,a,r){var n,o,i,s;n="dtfinder",o={url:null,locale:"en",manage:!0,upload:!0,uploadUrl:null,width:"100%",height:600,onSelect:!1,permissions:{create:!0,"delete":!0,move:!0},data:{}},i={_init:function(){this._currentPath="/",this._loadedPaths=[],this._cache=[],DTFINDER.config=this.opts,DTFINDER.config.data=e.extend({},o.data,this.opts.data),DTFINDER.config.permissions=e.extend({},o.permissions,this.opts.permissions),DTFINDER.File.url=this.opts.url,DTFINDER.File.data=this.opts.data,DTFINDER.Locale.locale=this.opts.locale,this.createElements(this.el,this.opts),this.initTree(),this.listen(this.el,this.opts),this.openRoot(),DTFINDER.Layout.handleScreenSize(),DTFINDER.Layout.listenWindowResize()},initTree:function(){var t=[{path:"/",label:"/",type:"dir"}],a=this;this.nav.dttree({nodes:t,onBeforeExpand:function(t,r){if(t=t.substr(1),-1===e.inArray(t,a._loadedPaths)){var n=DTFINDER.File.list(t);a._cache[t]=n,a._loadedPaths.push(t)}r.setChildren(a._cache[t],t),a.handleHight()}})},openRoot:function(){var t=window.location.hash.substr(1);if(t)for(var a=t.split("/"),r="",n="/";0!==a.length;)r=r+a.shift()+"/",r.trim(),"/"!=r&&(n=r.substr(0,r.length-1)),this.nav.dttree("expand",n);else{t="/",window.location.hash="/";e('a[href="#'+t+'"]');this.nav.dttree("expand",t)}this.open(t)},listen:function(t,a){var r=this;window.onpopstate=function(e){var t=window.location.hash.substr(1);r.open(t)},e("#sub-browser-dialog").on("click","a.dttree-node",function(t){t.preventDefault();var a=t.currentTarget;e("#sub-browser-dialog").find(".selected").removeClass("selected"),e(a).addClass("selected")}),a.manage&&(this.listenContextMenu(t),this.listenMobileContextMenu()),this.listenUpload(this._currentPath),this.listenCreateFolder(this._currentPath),this.listenRename(),this.listenSearch(),e(t).on("click",".dtf-file-item a",function(e){e.preventDefault()}),e(t).on("click",".img-item a",function(t){t.preventDefault(),e.isFunction(a.onISelect)&&a.onISelect(t)})},open:function(t){if(this._currentPath=t,-1===e.inArray(t,this._loadedPaths)){var a=DTFINDER.File.list(t);this._cache[t]=a,this._loadedPaths.push(t)}this.listenUpload(t),this.listenCreateFolder(t),this.updateBrowser(this._cache[t]),this.handleHight();var r=this.getParent(t);t=this.createBreadcrumb(t),e("#dtf-parent-folder").attr("href","#"+r),e("#dtf-breadcrumb").html(t)},createBreadcrumb:function(e){for(var t=e.substr(1).split("/"),a="#",r="",n=0;n<t.length;n++)a+="/"+t[n],r+='/<a href="'+a+'">'+t[n]+"</a>";return r},getParent:function(e){var t=e.split("/");return t.pop(),t.join("/")?t.join("/"):"/"},listenSearch:function(){var t=this;e(document).on("keyup",".dt-search-input",function(){var a=e(this).val();if(a.length>0){var r=DTFINDER.File.search(a,t._currentPath);t.updateBrowser(r)}else t.open(t._currentPath)})},listenRename:function(){var t=13,a=27,r=this;e(document).on("keyup",".dt-rename-input",function(n){if((n.keyCode==a||n.which==a)&&(e(n.target).parent().siblings("a").children(".file-name").show(),e(n.target).parent().remove()),n.keyCode==t||n.which==t){var o=e(this).data("path"),i=e(this).val();DTFINDER.File.rename(o,i),e(n.target).parent().siblings("a").children(".file-name").text(i).show(),e(n.target).parent().remove(),r.refresh()}}),e(document).on("blur",".dt-rename-input",function(t){e(t.target).parent().siblings("a").children(".file-name").show(),e(t.target).parent().remove()})},listenMobileContextMenu:function(t){var a=this;e(document).on("click",".dtf-mobile-context-action",function(t){t.preventDefault();var r=e(this).data("path"),n=e(this).data("op");a.handleMobileContexAction(n,r,e(this))})},handleMobileContexAction:function(t,a,r){var n=r.closest(".dtf-item");switch(t){case"rename":var o=e(n).find(".file-name"),i=o.text();o.hide(),e(n).append('<div><input data-path="'+a+'" type="text" style="height:18px;" class="form-control input-sm dt-rename-input" value="'+i+'"></div>'),e(n).find(".dt-rename-input").select();break;case"delete":if(!confirm("Are you sure you want to delete "+a+" ?, this cannot be undone."))return!1;DTFINDER.File["delete"](a);this.refresh();break;case"move":e("#sub-browser-dialog .modal-body").dttree({nodes:[{path:"/",label:"/",type:"dir"}],onBeforeExpand:function(e,t){e=e.substr(1);var a=DTFINDER.File.list(e);t.setChildren(a,e)}});var s=this;e("#sub-browser-dialog").on("click",".folder-selector",function(){var t=e("#sub-browser-dialog").find(".selected").attr("href").substr(1);DTFINDER.File.move(a,t),s.refresh(),e("#sub-browser-dialog").modal("hide")}),e("#sub-browser-dialog").modal("show");break;case"properties":a||(a=this._currentPath);var i=DTFINDER.File.properties(a),l=["<table>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Name")+"</td><td>"+i.Name+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Type")+"</td><td>"+i.Type+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Size")+"</td><td>"+i.Size+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Location")+"</td><td>"+i.Location+"</td></tr>","</table>"].join("");e("#properties-dialog").on("shown.bs.modal",function(t){e(this).find(".modal-body").html(l)}),e("#properties-dialog").modal("show")}},listenContextMenu:function(t){e(t).contextmenu({onItem:e.proxy(this.handleContext,this),before:function(a,r,n){var o=null;if(e(a.target).hasClass("dtf-context-holder"))e(t).data("context-holder",a.target),o=e(a.target).data("context-target");else{var i=e(a.target).parents();e.each(i,function(a,r){return e(r).hasClass("dtf-context-holder")?(e(t).data("context-holder",r),o=e(r).data("context-target"),!1):void 0})}return null===o?!1:(e(t).data("target",o),!0)}})},listenUpload:function(t){var a=e.extend({path:t,op:"upload"},this.opts.data);e("#upload-form").ajaxForm({data:a,success:e.proxy(function(a){this.refresh(t);for(var r=0;r<a.length;r++)e(".uploaded").append("<p> New file: "+a[r].uploaded+"</p>")},this)})},listenCreateFolder:function(t){var a=e.extend({path:t,op:"mkdir"},this.opts.data);e("#new-folder-form").ajaxForm({data:a,success:e.proxy(function(a){this.refresh(t),e("#new-folder-dialog").modal("hide")},this)})},handleHight:function(){var t=e(".dtf-area").height();e(".dtf-nav").height(t)},handleContext:function(t,a){a.preventDefault();var r=e(a.target).parent().data("action"),n=e(t).data("context-holder"),o=e(n).children("a").attr("href");switch(r){case"delete":if(!confirm("Are you sure you want to delete "+o+" ?, this cannot be undone."))return!1;DTFINDER.File["delete"](o);this.refresh();break;case"rename":var i=e(n).find(".file-name"),s=i.text();i.hide(),e(n).append('<div><input data-path="'+o+'" type="text" style="height:18px;" class="form-control input-sm dt-rename-input" value="'+s+'"></div>'),e(n).find(".dt-rename-input").select();break;case"new-folder":return e("#new-folder-dialog").on("shown.bs.modal",function(){e(".new-folder-input").select()}),void e("#new-folder-dialog").modal("show");case"move":e("#sub-browser-dialog .modal-body").dttree({nodes:[{path:"/",label:"/",type:"dir"}],onBeforeExpand:function(e,t){e=e.substr(1);var a=DTFINDER.File.list(e);t.setChildren(a,e)}});var l=this;e("#sub-browser-dialog").on("click",".folder-selector",function(){var t=e("#sub-browser-dialog").find(".selected").attr("href").substr(1);DTFINDER.File.move(o,t),l.refresh(),e("#sub-browser-dialog").modal("hide")}),e("#sub-browser-dialog").modal("show");break;case"properties":o||(o=this._currentPath);var s=DTFINDER.File.properties(o),d=["<table>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Name")+"</td><td>"+s.Name+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Type")+"</td><td>"+s.Type+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Size")+"</td><td>"+s.Size+"</td></tr>",'<tr><td class="property-label" valign="top" width="70px;">'+DTFINDER.Locale.localize("Location")+"</td><td>"+s.Location+"</td></tr>","</table>"].join("");e("#properties-dialog").on("shown.bs.modal",function(t){e(this).find(".modal-body").html(d)}),e("#properties-dialog").modal("show")}},updateBrowser:function(t){for(var a=e("<ul/>"),r=0;r<t.length;r++){var n=DTFINDER.DOM.createFileItem(t[r]);e(a).append(n)}e(this.browserArea).html(a)},refresh:function(e){"undefined"==typeof e&&(e=this._currentPath),data=DTFINDER.File.list("/"+e),this._cache[e]=data,this.updateBrowser(data);for(var t=this._loadedPaths.length-1;t--;)this._loadedPaths[t].trim()==e.trim()&&this._loadedPaths.splice(t,1);this._loadedPaths=[],this.nav.dttree("expand",e)},createElements:function(t,a){this.nav=e("<div/>").addClass("dtf-nav"),this.browserArea=e("<div/>").addClass("dtf-area ctn dtf-context-holder").data("context-target","#bro-context-menu"),this.navMobile=DTFINDER.DOM.createBreadcrumb();var r=e("<div/>").addClass("dtf-browser-container clearfix").css({width:"100%"}),n=e("<div/>").addClass("dtf-contianer clearfix"),o=DTFINDER.DOM.createToolbar(),i=this.opts.uploadUrl||this.opts.url,s=DTFINDER.DOM.createUploadDialog(i),l=this.opts.createFolderUrl||this.opts.url,d=DTFINDER.DOM.createNewFolderDialog(l),c=DTFINDER.DOM.createSubBrowserDialog(),p=DTFINDER.DOM.createPropertiesDialog(),h=DTFINDER.DOM.createItemContext(),u=DTFINDER.DOM.createBrowserContext();e(r).append(this.nav).append(this.browserArea),e(n).append(o).append(this.navMobile).append(r),e(t).append(n).after(h).after(u).after(s).after(d).after(c).after(p)}},s={},e.newPlugin(n,o,i,s)}(jQuery,window,document);